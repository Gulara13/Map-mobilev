<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Baku Once Upon a Time — Mobil</title>
  <style>
    :root{
      --ink:#111827; --muted:#6b7280; --ring:#93c5fd;
      --card:#ffffff; --bg:#ffffff;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    html,body{margin:0; height:100%; background:var(--bg); color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}

    .app{display:flex; flex-direction:column; min-height:100dvh; max-width:600px; margin:0 auto;}
    header{padding:10px 12px 6px; text-align:center;}
    header h1{margin:0; font-size:18px; font-weight:800;}
    header p.sub{margin:4px 0 0; font-size:13px; color:#374151;}

    /* Xəritə sahəsi */
    .map{position:relative; width:100%; height:60dvh; overflow:hidden; background:#fff;
         border-top:1px solid #eee; border-bottom:1px solid #eee;}
    .map img.bg{position:absolute; inset:0; width:100%; height:100%; object-fit:contain; z-index:0; user-select:none; pointer-events:none;}
    .pins{ position:absolute; inset:0; z-index:1; }

    /* Marker (pin) */
    .pin{
      position:absolute; width:36px; height:36px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      background:#111; color:#f5d7b5; font-size:14px; font-weight:700;
      box-shadow:0 6px 16px rgba(0,0,0,.18);
      transform:translate(-50%,-50%); /* koordinatı mərkəzə gətirir */
      touch-action:none; /* pointer sürüşdürməsində lazımdır */
    }
    .pin.active{ outline:3px solid var(--ring); background:#000; color:#fff; }
    .pin.edit{ cursor:grab; }
    .pin.dragging{ cursor:grabbing; }

    /* Üzən edit paneli */
    .tools{
      position:absolute; right:8px; top:8px; z-index:3;
      display:flex; gap:6px; align-items:center; background:rgba(255,255,255,.88);
      border:1px solid #e5e7eb; border-radius:999px; padding:6px 8px;
      box-shadow:0 6px 16px rgba(0,0,0,.12);
    }
    .tools .badge{ font-size:12px; color:#374151; }
    .tools .btn{ font-size:12px; padding:4px 8px; border:1px solid #e5e7eb; border-radius:999px; background:#fff; }

    /* Kart */
    .content{ padding:10px 12px 16px; }
    .card{ display:none; background:var(--card); border:1px solid #e5e7eb; border-radius:12px; padding:12px; }
    .card.active{ display:block; }
    .card h2{ margin:0 0 8px; font-size:16px; }
    .card img.media{ width:100%; height:auto; display:block; border-radius:10px; }
    .footer-note{ margin-top:10px; font-size:12px; color:var(--muted); text-align:center; }
.tools{ display:none; }
/* Kart məzmununu rahat oxunaqlı et */
.card{
  word-break: break-word;       /* uzun sözləri qır */
  overflow-wrap: anywhere;      /* hər yerdə qırmağa icazə ver */
  line-height: 1.5;             /* oxunaqlıq */
}
.card p{ margin: 8px 0; }
.card img.media{ width:100%; height:auto; display:block; border-radius:10px; }

/* Əgər kart içi çox uzanırsa, telefonlarda kənarlardan sıxmasın */
.content{ padding: 10px 12px 16px; }
    /* Kiçik cihazlar üçün */
    @media (max-width:420px){
      .pin{ width:32px; height:32px; font-size:13px; }
      header h1{ font-size:17px; } header p.sub{ font-size:12px; }
    }
    @media (max-width:340px){
      .pin{ width:28px; height:28px; font-size:12px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header id="appHeader">
      <h1>Baku: Once Upon a Time</h1>
      <p class="sub">Click on the numbers on the map to learn more.</p>
    </header>

    <section class="map" id="mapBox">
      <!-- Üzən edit paneli -->
      <div class="tools" id="tools">
        <span class="badge" id="modeBadge">Rejim: Baxış</span>
        <button class="btn" id="toggleEdit">Düzənlə</button>
        <button class="btn" id="copyCoords">Koordinatları kopyala</button>
      </div>

      <!-- Xəritə şəkli + marker konteyneri -->
      <img src="./assets/background.jpg" alt="Xəritə" class="bg" id="bgImg" />
      <div class="pins" id="pins"></div>
    </section>

    <section class="content">
      <article class="card" id="card"></article>
      <p class="footer-note">Qeyd: Xəritə tam görünür; markerlər ekran ölçüsünə uyğun avtomatik yerləşdirilir.</p>
    </section>
  </div>

  <script>
    // ----- Kart məlumatları -----
    const ITEMS = [
      {title:"Baku Children’s Railway", html:`<img src="./assets/1.png" alt="1" class="media"><p>Baku Children’s Railway (BUDY) was a children’s railway that operated in Baku from 1947 to 2009. Its opening ceremony was held on August 10, 1947. The railway was 1,050 meters long and consisted of two stations — Dədə Qorqud and Bahar, a locomotive depot, a training building, 2 TU2 diesel locomotives, and 6 Pafawag carriages. It was located in the park named after Shahriyar. Since 2004, its official name had been Azerbaijan State Children’s Railway (ADUDY)</p>`},
      {title:"Baku Children’s Railway", html:`<img src="./assets/2.png" alt="2" class="media"><p>In the early 1990s, attention to the Baku Children’s Railway (BUDY) declined. BUDY was removed from the list of the Azerbaijan State Railways (ADDY). However, starting from January 2002, renewed attention was given to the Baku Children’s Railway. In June 2009, the Baku Children’s Railway was dismantled. Initially, it was announced that these works were related to reconstruction. Later, it was stated that the children’s railway would be reopened in Ganja. However, since then, no information has been provided regarding the restoration of the railway.</p>`},
      {title:"Montin Park", html:`<img src="./assets/3.png" alt="3" class="media"><p>The southern arc-shaped boundary of Montin was the railway. Along this railway, a large forest park area had been created. The main entrance to the park was located near the Montin market and the district polyclinic. On both sides, the ceremonial white gates were decorated with mosaics depicting folk musicians and dancers.</p>`},
      {title:"Montin Park", html:`<img src="./assets/4.png" alt="4" class="media"><p>Later, the area of Montin Park was significantly reduced. The park was enclosed with numerous fences. The old park was renamed after Azerbaijan’s National Hero, Samir Khasiyev.</p>`},
      {title:"Karabakh Hotel", html:`<img src="./assets/5.png" alt="5" class="media"><p>Karabakh Hotel — The hotel building was constructed in 1974. Its architects were B. Shulgin and E. Melkhisedekov, and the structural engineers were K. Karimov and G. Shamilov. Until 1989, the hotel was called “Tourist”, after which it was renamed “Karabakh.” Built on a rocky hill, the Karabakh was included in the Encyclopedia of World Architecture published in New York in 1978. In 1979, the building’s design was awarded the Le Corbusier Prize.</p>`},
      {title:"Karabakh Hotel", html:`<img src="./assets/6.png" alt="6" class="media"><p>In 2004, the company Uğur 97 purchased the building of the Karabakh Hotel. At first, the building was demolished down to the first floor, but later, for unknown reasons, the demolition works were stopped. For a while, the hotel area functioned as a paid parking lot, and afterwards, it was completely demolished. Today, the site where the hotel once stood remains empty.</p>`},
      {title:"The Haji Farajulla Hammam", html:`<img src="./assets/7.png" alt="7" class="media"><p>This building, designed by architect Mashadi Gasim Izmayilov, was constructed in 1888 as the Haji Farajulla Hammam (bathhouse). It was a historical monument of local significance.</p>`},
      {title:"The Haji Farajulla Hammam", html:`<img src="./assets/8.png" alt="8" class="media"><p>Later, the hammam became the building of the Azerbaijan State Yugh Theatre. On May 18, 2016, the hamam was removed from the list of historical monuments, and shortly afterwards it was demolished. At present, the Yugh Theatre operates in the small hall of the Puppet Theatre building.</p>`},
    ];

    /*
      Başlanğıc marker yerləri — SƏNİN FAİZ DƏYƏRLƏRİN.
      İstəsən sonradan “Koordinatları kopyala” ilə yenisini bu massivə yapışdırarsan.
    */
    let positionsPercent = [
   { "top": "55.8%", "left": "42.6%" },
  { "top": "56.1%", "left": "28.9%" },
  { "top": "57.0%", "left": "71.0%" },
  { "top": "76.6%", "left": "68.9%" },
  { "top": "95.5%", "left": "47.9%" },
  { "top": "98.0%", "left": "35.7%" }, // 100.6% → 98.0%
  { "top": "74.6%", "left": "22.1%" },
  { "top": "85.4%", "left": "10.4%" }
    ];

    // --- DOM
    const mapBox   = document.getElementById('mapBox');
    const pinsEl   = document.getElementById('pins');
    const card     = document.getElementById('card');
    const bgImg    = document.getElementById('bgImg');
    const appHeader= document.getElementById('appHeader');

    // Toolbar
    const tools         = document.getElementById('tools');
    const modeBadge     = document.getElementById('modeBadge');
    const toggleEditBtn = document.getElementById('toggleEdit');
    const copyCoordsBtn = document.getElementById('copyCoords');

    // Edit rejimi (URL və ya localStorage)
let editMode = (new URLSearchParams(location.search).get('edit') === '1');


    function setModeUI(){
      modeBadge.textContent = `Rejim: ${editMode ? 'Düzənlə' : 'Baxış'}`;
      toggleEditBtn.textContent = editMode ? 'Baxış' : 'Düzənlə';
      document.getElementById('tools').style.display = editMode ? 'flex' : 'none';
    }

    // Şəklin orijinal ölçüsü
    let natW = 0, natH = 0;
    // Piksel koordinatları (şəklin orijinal ölçüsünə görə)
    let positionsPx = [];

    function fitMapHeight(){
      const headerH = appHeader.offsetHeight || 0;
      const h = Math.max(320, window.innerHeight - headerH - 56); // 56px buffer
      mapBox.style.height = `${h}px`;
    }

    function ensureImageSize(){
      return new Promise((resolve)=>{
        if(bgImg.naturalWidth){
          natW = bgImg.naturalWidth; natH = bgImg.naturalHeight; resolve();
        }else{
          const tmp = new Image();
          tmp.src = bgImg.src;
          tmp.onload = ()=>{ natW = tmp.naturalWidth; natH = tmp.naturalHeight; resolve(); };
        }
      });
    }

    // Faiz → px (natural ölçüyə görə)
    function pctToPx(){
      positionsPx = positionsPercent.map(p=>{
        const t = parseFloat(String(p.top).replace('%',''))/100;
        const l = parseFloat(String(p.left).replace('%',''))/100;
        return { x: Math.round(natW*l), y: Math.round(natH*t) };
      });
    }

    // px → faiz (clipboard üçün)
    function pxToPercentArr(){
      return positionsPx.map(p => ({
        top:  ((p.y / natH) * 100).toFixed(1) + '%',
        left: ((p.x / natW) * 100).toFixed(1) + '%'
      }));
    }

    // Markerləri çək (contain üçün ofset + skala)
    function renderPins(){
      const wrap = mapBox.getBoundingClientRect();
      const img  = bgImg.getBoundingClientRect();

      const scale = natW ? (img.width / natW) : 1;
      const offX  = img.left - wrap.left;
      const offY  = img.top  - wrap.top;

      pinsEl.innerHTML = positionsPx.map((p,i)=>{
        const x = offX + p.x * scale;
        const y = offY + p.y * scale;
        const cls = `pin${editMode ? ' edit' : ''}`;
        return `<button class="${cls}" style="left:${x}px; top:${y}px" data-idx="${i}" aria-label="Bölmə ${i+1}">${i+1}</button>`;
      }).join('');
    }

    // Kart göstər
    function showCard(idx){
      const item = ITEMS[idx-1];
      if(!item) return;
      card.innerHTML = `<h2>${item.title}</h2>${item.html}`;
      card.classList.add('active');
      document.querySelectorAll('.pin').forEach(p=>p.classList.remove('active'));
      const active = document.querySelector(`.pin[data-idx="${idx-1}"]`);
      if(active) active.classList.add('active');
      card.scrollIntoView({behavior:'smooth', block:'start'});
    }

    // Kliklə kart aç
    document.addEventListener('click', (e)=>{
      const pin = e.target.closest('.pin');
      if(pin && !editMode){
        const id = parseInt(pin.dataset.idx, 10) + 1;
        showCard(id);
      }
    });

    // --- Sürüşdürmə: touch + mouse (Pointer Events)
    let dragging = null;
    pinsEl.addEventListener('pointerdown', (e)=>{
      const pin = e.target.closest('.pin');
      if(!pin || !editMode) return;
      dragging = pin;
      dragging.setPointerCapture(e.pointerId);
      dragging.classList.add('dragging');
    });

    pinsEl.addEventListener('pointermove', (e)=>{
      if(!dragging || !editMode) return;
      const wrap = mapBox.getBoundingClientRect();
      const img  = bgImg.getBoundingClientRect();
      const scale = img.width / natW;
      const idx = parseInt(dragging.dataset.idx, 10);

      const xOnImg = e.clientX - img.left;
      const yOnImg = e.clientY - img.top;

      const xClamped = Math.max(0, Math.min(xOnImg, img.width));
      const yClamped = Math.max(0, Math.min(yOnImg, img.height));

      positionsPx[idx] = { x: Math.round(xClamped / scale), y: Math.round(yClamped / scale) };

      dragging.style.left = ( (img.left - wrap.left) + xClamped ) + 'px';
      dragging.style.top  = ( (img.top  - wrap.top ) + yClamped ) + 'px';
    });

    function endDrag(e){
      if(!dragging) return;
      dragging.classList.remove('dragging');
      dragging.releasePointerCapture?.(e.pointerId);
      dragging = null;
    }
    pinsEl.addEventListener('pointerup', endDrag);
    pinsEl.addEventListener('pointercancel', endDrag);

    // Toolbar düymələri
    toggleEditBtn.addEventListener('click', ()=>{
  editMode = !editMode;
  setModeUI();
  renderPins();
});

    copyCoordsBtn.addEventListener('click', async ()=>{
      const json = JSON.stringify(pxToPercentArr(), null, 2);
      try{
        await navigator.clipboard.writeText(json);
        copyCoordsBtn.textContent = 'Kopyalandı!';
        setTimeout(()=> copyCoordsBtn.textContent = 'Koordinatları kopyala', 1200);
      }catch{
        const ta = document.createElement('textarea');
        ta.value = json; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        alert('Koordinatlar kopyalandı.');
      }
    });

    // Başlat
    async function init(){
      setModeUI();
      fitMapHeight();
      await ensureImageSize();
      pctToPx();         // faizləri px-ə çevir
      renderPins();      // markerləri çək
      window.addEventListener('resize', ()=>{ fitMapHeight(); renderPins(); });
      window.addEventListener('orientationchange', ()=>{ fitMapHeight(); renderPins(); });
    }
    init();
  </script>
</body>
</html>





